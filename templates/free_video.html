{% extends 'base.html' %}
{% block title %}ë¬´ë£Œ ì˜ìƒ{% endblock %}
{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">ğŸ¥ ë¬´ë£Œ ì˜ìƒ</h2>
    <a href="/" class="btn btn-outline-secondary btn-sm">í™ˆìœ¼ë¡œ</a>
  </div>

  {% if session.user.role in ['admin', 'teacher', 'superadmin'] %}
    <a href="{{ url_for('upload_video', video_type='free') }}" class="btn btn-success mb-4">ë¬´ë£Œ ì˜ìƒ ì—…ë¡œë“œ</a>
  {% endif %}

  {% if videos %}
    <div class="list-group">
      {% for video in videos %}
      <div class="list-group-item list-group-item-action shadow-sm mb-3 rounded d-flex">
        {% set thumb = 'thumbnails/' + video['thumbnail'] if video['thumbnail'] else 'videos/' + video['filename'] %}
        <img src="{{ url_for('static', filename=thumb) }}"
             alt="ì¸ë„¤ì¼"
             class="rounded me-3"
             style="width: 200px; height: 120px; object-fit: cover;">

        <div class="flex-grow-1">
          <h5 class="mb-1">{{ video['title'] }}</h5>
          <p class="mb-1 text-muted">
            ğŸ‘¨â€ğŸ« {{ video['nickname'] }} &nbsp;&nbsp;
            ğŸ“… {{ video['created_at'][:10] }} &nbsp;&nbsp;
            â± {{ video['duration'] or 'ê¸¸ì´ ì •ë³´ ì—†ìŒ' }}
          </p>
          <p class="mb-2">{{ video['description'] }}</p>

          <a href="{{ url_for('watch_video', video_id=video['id']) }}" class="btn btn-primary btn-sm">ì˜ìƒ ë³´ê¸°</a>

          {% if session.user.role == 'superadmin' or session.user.id == video['uploader_id'] %}
            <a href="{{ url_for('edit_video', video_id=video['id']) }}" class="btn btn-outline-secondary btn-sm ms-2">ìˆ˜ì •</a>
            <form action="{{ url_for('delete_video', video_id=video['id']) }}" method="POST" style="display:inline;">
              <button type="submit" class="btn btn-outline-danger btn-sm ms-1"
                      onclick="return confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?');">ì‚­ì œ</button>
            </form>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">ë“±ë¡ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>
  {% endif %}
</div>
{% endblock %}
